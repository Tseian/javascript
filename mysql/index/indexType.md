## Mongodb 索引
### 索引的类型
- 单字段索引

  ，是最常见的索引形式，MongoDB默认创建的id索引也是这种类型。

- 复合索引
  
  复合索引是Single Field Index的升级版本，它针对多个字段联合创建索引，先按第一个字段排序，第一个字段相同的文档按第二个字段排序，依次类推，如下针对age, name这2个字段创建一个复合索引。

- 多key索引
  
  当索引的字段为数组时，创建出的索引称为多key索引，多key索引会为数组的每个元素建立一条索引，比如person表加入一个habbit字段（数组）用于描述兴趣爱好，需要查询有相同兴趣爱好的人就可以利用habbit字段的多key索引。

- 哈希索引
  
  是指按照某个字段的hash值来建立索引，目前主要用于MongoDB Sharded Cluster的Hash分片，hash索引只能满足字段完全匹配的查询，不能满足范围查询等。

- 地理位置索引
  
  能很好的解决O2O的应用场景，比如『查找附近的美食』、『查找某个区域内的车站』等。

- 文本索引
  
  能解决快速文本查找的需求，比如有一个博客文章集合，需要根据博客的内容来快速查找，则可以针对博客内容建立文本索引。

### 索引的额外属性

- 唯一索引 (unique index)：保证索引对应的字段不会出现相同的值，比如_id索引就是唯一索引
- TTL索引：可以针对某个时间字段，指定文档的过期时间（经过指定时间后过期 或 在某个时间点过期）
- 部分索引 (partial index): 只针对符合某个特定条件的文档建立索引，3.2版本才支持该特性
- 稀疏索引(sparse index): 只针对存在索引字段的文档建立索引，可看做是部分索引的一种特殊情况


### 索引优化

- db profiling
  
  - 0： 不开启profiling
  - 1： 将处理时间超过某个阈值(默认100ms)的请求都记录到DB下的system.profile集合 （类似于mysql、redis的slowlog）
  - 2： 将所有的请求都记录到DB下的system.profile集合（生产环境慎用）

- 查询计划 explain()方法 查看详细的查询计划来决定如何优化